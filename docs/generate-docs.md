# generate-docs.py

*Auto-generated from `.github/scripts/generate-docs.py`*

# Advanced Auto‑Documentation Generator  
*`generate-docs.py` – A CI/CD helper that automatically produces Markdown documentation, changelog entries, cross‑file impact analysis, and a smart PR comment for any TypeScript/JavaScript/Python project.*

> **TL;DR**  
> Run the script in a repository that has a `changed_files.txt` (generated by your CI pipeline).  
> It will:
> 1. Detect breaking changes in the changed files.  
> 2. Generate Markdown docs for each file (using the Groq API).  
> 3. Create a `CHANGELOG.md` entry.  
> 4. Produce a cross‑file impact report.  
> 5. Write a PR comment (`doc_output.md`) that can be posted to GitHub.  
> 6. Create a `breaking_changes.txt` flag file if any breaking changes were found.

---

## 1. Overview

The script is a **single‑file, self‑contained CLI** that automates the tedious parts of maintaining documentation in a fast‑moving codebase:

| Feature | What it does |
|---------|--------------|
| **Breaking‑change detection** | Compares the current and previous versions of each changed file to find removed exports or signature changes. |
| **Diff‑aware docs** | Passes the current file content (and a snippet of its diff) to the Groq LLM to generate concise, Markdown‑formatted docs. |
| **Changelog generation** | Builds a dated section in `CHANGELOG.md` with added/removed/changed symbols. |
| **Cross‑file impact analysis** | Scans all changed files for references to symbols defined elsewhere, highlighting potential regressions. |
| **Smart PR comment** | Produces a single Markdown comment that can be posted to the PR, summarizing everything above. |
| **CI‑friendly** | Reads `changed_files.txt` (created by your CI), writes docs to `docs/`, and writes a flag file (`breaking_changes.txt`) that can be used by GitHub Actions to add a label. |

The script relies on the **Groq API** (OpenAI‑compatible) for natural‑language documentation generation.  
Set the environment variable `GROQ_API_KEY` before running.

---

## 2. Exports

| Export | Type | Description |
|--------|------|-------------|
| `extract_symbols_detailed` | function | Parses a source file and returns a list of exported symbols (functions, classes, interfaces) with metadata. |
| `detect_breaking_changes` | function | Compares two file versions and reports any breaking changes. |
| `get_git_diff` | function | Returns the `git diff` between the last two commits for a given file. |
| `analyze_cross_file_impact` | function | Detects references to changed symbols across the changed files. |
| `generate_changelog_entry` | function | Builds a Markdown snippet for the changelog for a single file. |
| `generate_documentation` | function | Calls the Groq API to produce documentation for a file’s current state. |
| `generate_impact_analysis` | function | Formats the cross‑file impact data into a Markdown section. |
| `main` | function | Orchestrates the entire workflow. |
| `update_changelog` | function | Inserts a new dated section into `CHANGELOG.md`. |
| `generate_smart_pr_comment` | function | Builds the final PR comment that summarizes breaking changes, docs, impacts, and actions. |

> **Note** – All functions are defined at module level; the script is intended to be executed directly (`python generate-docs.py`).

---

## 3. Usage Examples

### 3.1 Running the Script

```bash
# 1. Ensure Groq API key is set
export GROQ_API_KEY="sk-xxxxxx"

# 2. Create a list of changed files (CI pipeline usually does this)
git diff --name-only HEAD~1 HEAD > changed_files.txt

# 3. Run the generator
python .github/scripts/generate-docs.py
```

The script will create:

- `docs/<file>.md` for each changed file
- `CHANGELOG.md` (new dated section)
- `doc_output.md` (PR comment)
- `breaking_changes.txt` (if any breaking changes)

### 3.2 Generating Documentation for a Single File

```python
from pathlib import Path
from generate_docs import generate_documentation

file_path = Path("src/utils/helpers.ts")
content = file_path.read_text()

doc_md = generate_documentation(content, str(file_path))
print(doc_md)
```

The returned Markdown will include:

- Overview of the module
- Export list
- Usage examples
- Parameter and return descriptions

### 3.3 Detecting Breaking Changes

```python
old = Path("src/utils/helpers.ts").read_text()
new = Path("src/utils/helpers.ts").read_text()

break_info = detect_breaking_changes(old, new)
if break_info['has_breaking']:
    for change in break_info['changes']:
        print(change['message'])
```

### 3.4 Cross‑File Impact Analysis

```python
files = {
    "src/a.ts": Path("src/a.ts").read_text(),
    "src/b.ts": Path("src/b.ts").read_text(),
}
impacts = analyze_cross_file_impact(files)
print(impacts)
```

---

## 4. Parameters & Return Values

Below is a concise reference for each exported function.

| Function | Parameters | Return Value | Description |
|----------|------------|--------------|-------------|
| `extract_symbols_detailed(content: str)` | `content` – source code string | `List[Dict]` – each dict contains `type`, `name`, `exported`, `signature`, and optionally `params`, `returns` | Parses the file and returns a list of exported symbols. |
| `detect_breaking_changes(old_content: Optional[str], new_content: str)` | `old_content` – previous file content (or `None` if new file) <br> `new_content` – current file content | `Dict` with keys `has_breaking` (bool) and `changes` (list of change dicts) | Compares old and new symbols, reporting removed exports or signature changes. |
| `get_git_diff(file_path: str)` | `file_path` – path to file relative to repo root | `str` – raw diff text or `None` if error | Runs `git diff HEAD~1 HEAD <file>` and returns the diff. |
| `analyze_cross_file_impact(files_data: Dict[str, str])` | `files_data` – mapping of file paths to file contents | `List[Dict]` – each dict contains `changed_file`, `affects_file`, `symbol`, `type` | Detects references to changed symbols across the set of files. |
| `generate_changelog_entry(file_path: str, old_content: Optional[str], new_content: str, breaking_info: Dict)` | `file_path` – path of file <br> `old_content` – previous content or `None` <br> `new_content` – current content <br> `breaking_info` – output of `detect_breaking_changes` | `Optional[str]` – Markdown snippet or `None` if nothing changed | Builds a changelog section for the file. |
| `generate_documentation(file_context: str, file_path: str)` | `file_context` – diff‑aware context string <br> `file_path` –
# pages-manager.py

*Auto-generated from `.github/scripts/pages-manager.py`*

# `pages-manager.py`

> **Intelligent GitHub Pages Documentation Manager**  
> A Python script that automatically reads your source‑code documentation, decides how to best organize it into a GitHub Pages site, and writes the resulting Markdown files.  
> It uses an LLM (via the `llm` wrapper) to make agentic decisions about whether to create, append, or modify pages, and it keeps a persistent mapping of source files to generated pages.

---

## 1. Overview

The module is a **CI‑driven documentation generator**.  
When a set of Markdown files (typically one per TypeScript source file) is passed to the script, it:

1. **Scans** the existing `docs-site/` directory for current pages.  
2. **Analyzes** each source file’s documentation to decide which *perspectives* (API, Module, Feature) are relevant.  
3. **Uses an LLM** to decide whether to create a new page, append to an existing one, or modify an existing page.  
4. **Writes** the new/updated Markdown files, preserving front‑matter and timestamps.  
5. **Generates** index pages (`api/index.md`, `modules/index.md`, `features/index.md`, and the root `index.md`).  
6. **Persists** a mapping (`.github/pages-mapping.json`) that tracks which source file produced which page(s) and when.

The script is intended to be run in a CI job whenever source files change.

---

## 2. Exports

| Export | Type | Description |
|--------|------|-------------|
| `PagesManager` | **class** | Core class that handles scanning, decision‑making, and file manipulation. |
| `process_docs_to_pages(doc_files: List[str])` | **function** | High‑level entry point that processes a list of Markdown files and updates the GitHub Pages site. |
| `PAGES_DIR` | **Path** | Directory where the generated site lives (`docs-site/`). |
| `MAPPING_FILE` | **Path** | Path to the JSON file that stores the mapping (`.github/pages-mapping.json`). |
| `MODEL` | **str** | LLM model identifier (`openai/gpt-oss-120b`). |
| `GROQ_API_KEY` | **str** | Environment variable that holds the API key for the LLM provider. |

> *Note:* The `if __name__ == "__main__":` block is not exported; it simply drives the script when run from the command line.

---

## 3. Usage Examples

### 3.1 Using the `PagesManager` class directly

```python
from pathlib import Path
from pages_manager import PagesManager

# Instantiate the manager
manager = PagesManager()

# Example: generate docs for a single file
source_file = "auth.ts"
doc_content = Path("docs/auth.md").read_text(encoding="utf-8")

# 1. Decide which perspectives to create
perspectives = manager.generate_multi_perspective_docs(source_file, doc_content)
# perspectives → List[Tuple[str, str, str]]  (page_path, action, reasoning)

# 2. Apply each decision
for page_path, action, reasoning in perspectives:
    manager.apply_documentation_change(page_path, action, doc_content)

# 3. Regenerate index pages
manager.generate_index_page()

# 4. Persist mapping
manager.save_mapping()
```

### 3.2 Using the high‑level helper

```python
from pages_manager import process_docs_to_pages

# Suppose you have a list of Markdown files that correspond to changed source files
doc_files = [
    "docs/auth.md",
    "docs/database.md",
    "docs/payment.md",
]

# Run the whole pipeline
process_docs_to_pages(doc_files)
```

### 3.3 Running from the command line

```bash
# In your CI job
python .github/scripts/pages-manager.py
```

The script will:

1. Read `changed_files.txt` (generated by your CI pipeline).  
2. Map each changed source file to its Markdown counterpart in `docs/`.  
3. Call `process_docs_to_pages` on the resulting list.

---

## 4. Parameters & Return Values

### 4.1 `PagesManager.__init__()`

| Parameter | Type | Description |
|-----------|------|-------------|
| *None* | | Initializes internal state. |

| Return | Type | Description |
|--------|------|-------------|
| *None* | | Instantiates the manager; loads mapping and scans existing pages. |

---

### 4.2 `PagesManager.load_mapping() -> Dict`

| Parameter | Type | Description |
|-----------|------|-------------|
| *None* | | Reads `.github/pages-mapping.json` if it exists. |

| Return | Type | Description |
|--------|------|-------------|
| `Dict` | Mapping structure (see `save_mapping` for format). |

---

### 4.3 `PagesManager.save_mapping() -> None`

| Parameter | Type | Description |
|-----------|------|-------------|
| *None* | | Writes the current mapping to disk. |

| Return | Type | Description |
|--------|------|-------------|
| `None` | | Side‑effect: file written. |

---

### 4.4 `PagesManager.scan_existing_pages() -> Dict[str, str]`

| Parameter | Type | Description |
|-----------|------|-------------|
| *None* | | Walks `PAGES_DIR` for all `.md` files. |

| Return | Type | Description |
|--------|------|-------------|
| `Dict[str, str]` | `relative_path → content` | Mapping of all existing pages. |

---

### 4.5 `PagesManager.generate_multi_perspective_docs(source_file: str, doc_content: str) -> List[Tuple[str, str, str]]`

| Parameter | Type | Description |
|-----------|------|-------------|
| `source_file` | `str` | Name of the source file (e.g., `"auth.ts"`). |
| `doc_content` | `str` | Markdown content of the source file’s documentation. |

| Return | Type | Description |
|--------|------|-------------|
| `List[Tuple[str, str, str]]` | `(page_path, action, reasoning)` | One tuple per perspective (API, Module, Feature). |

---

### 4.6 `PagesManager.make_intelligent_decision(source_file: str, doc_content: str, perspective: str = 'api') -> Tuple[str, str, str]`

| Parameter | Type | Description |
|-----------|------|-------------|
| `source_file` | `str` | Source file name. |
| `doc_content` | `str` | Markdown content. |
| `perspective` | `str` | One of `"api"`, `"module"`, `"feature"`. |

| Return | Type | Description |
|--------|------|-------------|
| `Tuple[str, str, str]` | `(page_path, action, reasoning)` | Decision for this perspective. |

---

### 4.7 `PagesManager._fallback_decision(source_file: str, perspective: str = 'api') -> Tuple[str, str, str]`

| Parameter | Type | Description |
|-----------|------|-------------|
| `source_file` | `str` | Source file name. |
| `perspective` | `str` | Perspective type. |

| Return | Type | Description |
|--------|------|-------------|
| `Tuple[str, str, str]` | `(page_path, action, reasoning)` | Fallback decision when LLM fails. |

---

###